---
title: "p8150_hw2_wz2629"
author: Wen Dai
date: "2023-09-27"
output: 
  github_document
---

```{r message=FALSE}
library (tidyverse)
library(readxl)
```

# Problem 1:
Step1 : clean the data in pols-month.csv
```{r}
month_df = 
  tibble(
    month_num = 1:12,
    month_abb = month.abb,
    month = month.name
  )

polmonth_df = 
  read_csv("fivethirtyeight_datasets/pols-month.csv") |>
  separate(mon, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    president = recode(prez_gop, "0" = "dem", "1" = "gop", "2" = "gop")) |>
  left_join(x = _, y = month_df) |> 
  select(year, month, everything(), -day, -starts_with("prez"))
```

Step 2: clean the data in snp.csv

```{r}
snp_df = 
  read_csv(
    "fivethirtyeight_datasets/snp.csv",
    col_types = cols(date = col_date(format = "%m/%d/%y"))) |>
  separate(date, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    year = if_else(year > 2023, year - 100, year)) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, close) 
```


Step 3: clean the data in unemployment.csv
```{r}
  unemployment_df=read_csv("fivethirtyeight_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month_abb",
    values_to = "unemployment"
  ) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, unemployment)

```

step 4:
Join the dataset by merging snp into pols, and merging unemployment into the result.
```{r}
combine = 
  left_join(polmonth_df, snp_df) |>
  left_join(x = _, y = unemployment_df)

str(combine)
```

Step 5:
Write a short paragraph about these data set.
Explain briefly what each dataset contained, and describe the resulting dataset. 
(e.g. give the dimension, range of years and names of key variables)

Notice that there are some `NA` values in the `close` and `unemployment` variables, which indicate that the value of these variables is missing at those locations.

Let's talk about the "combine_df" datasets. The `polmonth_df` data has `r nrow(polmonth_df)` observations and `r ncol(polmonth_df)` variables and tells us about the party affiliation distribution (democrat or republican) for governors and senators for a given year from years `r polmonth_df |> pull(year) |> min()` to `r polmonth_df |> pull(year) |> max()`. It also tells us whether the sitting president was a democrat or republican. 

The `snp_df` data has `r nrow(snp_df)` observations and `r ncol(snp_df)` variables, ranging from years `r snp_df |> pull(year) |> min()` to `r snp_df |> pull(year) |> max()`. 

The `unemployment_df` data has `r nrow(unemployment_df)` observations and `r ncol(unemployment_df)` variables ranging from years `r unemployment_df |> pull(year) |> min()` to `r unemployment_df |> pull(year) |> max()`.

In Januarys in or after 1975 in which a democrat was president, the **average unemployment rate was `r filter(combine, month == "January", year >= 1975, president == "dem") |> pull(unemployment) |> mean() |> round(2)`**.  The average unemployment rate over the same time period in which a republican was president was `r filter(combine, month == "January", year >= 1975, president == "gop") |> pull(unemployment) |> mean() |> round(2)`.

